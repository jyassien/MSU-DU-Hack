<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="style.css">
  <title>Forum for Issues</title>
</head>
<body>

  <!-- Navigation bar-->
  <div class="navbar">
    <a href="#home">Home</a>
    <div class="dropdown">
      <button class="dropbtn">Campus
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-content">
        <a href="#Campus-News">News</a>
        <a href="#Campus-Directions">Directions</a>
        <a href="#Campus-Issues">Issues</a>
      </div>
    </div>
    <div class="dropdown">
      <button class="dropbtn">Food
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-content">
        <a href="#Food-News">News</a>
        <a href="#Food-Reviews">Reviews</a>
        <a href="#Food-Issues">Issues</a>
      </div>
    </div>
    <div class="dropdown">
      <button class="dropbtn">Dorms
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-content">
        <a href="#Dorms-News">News</a>
        <a href="#Dorms-Issues">Issues</a>
      </div>
    </div>
  </div> 

   <!-- A button to open the popup form -->
<button class="open-button" onclick="openForm()">New Post</button>

<!-- The new post submission form -->
<div class="form-popup" id="newPostForm">
  <form class="form-container" action="">
    <h1>New Post</h1>

    <label for="title"><b>Title</b></label>
    <input type="text" placeholder="Enter title" name="title" id="postTitle" required>

    <label for="desc"><b>Description</b></label>
    <input type="text" placeholder="Enter description" name="desc" id="postContent" required>

    <button type="submit" class="btn">Submit</button>
    <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
  </form>
</div> 

  <form>
    <input type="text" name="search"
    placeholder="Search...">
  </form>

  <!-- Main container for all posts -->
  <div id="mainContainer"></div>
 
  <script>
    // Database URL
    const firebaseDatabaseURL = "https://msuduhackton.firebaseio.com";
    
    // Add your auth token here
    const authToken = 'Qo48kLx2pbVoBJOC6dJhslRm35319dam4oOPwfwg';

    // Event Listener for form submission
    document.getElementById('newPostForm').children[0].addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Extract form field values
      const title = document.getElementById('postTitle').value;
      const content = document.getElementById('postContent').value;
      const category = window.location.hash.substr(1).split("-")[0];
      const community = window.location.hash.substr(1).split("-")[1];
      
      // Create a new post object
      const newPost = {
        title: title,
        content: content,
        upvotes: 0
      };
      
      // Firebase endpoint for storing posts
      const postUrl = `${firebaseDatabaseURL}/posts/${category}/${community}.json?auth=${authToken}`;
      console.log(postUrl);
      // Perform a POST request to Firebase
      fetch(postUrl, {
        method: 'POST',
        body: JSON.stringify(newPost)
      })
      .then(response => response.json())
      .then(data => {
        console.log('Success:', data);
        alert("Hi");
        // Clear form fields
        document.getElementById('postTitle').value = '';
        document.getElementById('postContent').value = '';
        // Refresh posts
        filterPosts();
      })
      .catch((error) => {
        console.error('Error:', error);
      });
    });

    window.addEventListener('DOMContentLoaded', function() {
      filterPosts();
    });

    // Function to filter and display posts
    function filterPosts() {
      const hashPart = window.location.hash.substr(1);
      const category = hashPart.split("-")[0];
      const community = hashPart.split("-")[1];

      const fetchUrl = `${firebaseDatabaseURL}/posts/${category}/${community}.json?auth=${authToken}`;
      
      fetch(fetchUrl)
      .then(response => response.json())
      .then(data => updatePosts(data));
    }
    
    // Function to display posts
    function updatePosts(posts) {
      const container = document.getElementById('mainContainer');
      container.innerHTML = '';
      for (const postId in posts) {
        const post = posts[postId];
        const postDiv = document.createElement('div');
        postDiv.className = 'post';
        postDiv.innerText = `Title: ${post.title}, Content: ${post.content}, Upvotes: ${post.upvotes}`;
        container.appendChild(postDiv);
      }
    } 
  function openForm() {
    document.getElementById("newPostForm").style.display = "block";
  }

  function closeForm() {
    document.getElementById("newPostForm").style.display = "none";
  } 
  </script>
</body>
</html>


